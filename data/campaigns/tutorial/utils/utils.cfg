#textdomain wesnoth-tutorial

#define LABEL STRING POSITION
    [label]
        x,y={POSITION}
        text={STRING}
    [/label]
#enddef

#define UNLABEL POSITION
    [label]
        x,y={POSITION}
        text=""	# wmllint: ignore
    [/label]
#enddef

#define PRINT STRING
    [print]
        text={STRING}
        size=18
        duration=10000
        red,green,blue=255,255,255
    [/print]
#enddef

#define CLEAR_PRINT
    [print]
        text=""	# wmllint: ignore
    [/print]
#enddef

#define NUMEQ VAR VALUE
    [variable]
        name={VAR}
        numerical_equals={VALUE}
    [/variable]
#enddef

#define BOOLEQ VAR VALUE
    [variable]
        name={VAR}
        boolean_equals={VALUE}
    [/variable]
#enddef

#define GENDER MALE_WML FEMALE_WML
    [if]
        [have_unit]
            id=student
            gender=male
        [/have_unit]
        [then]
            {MALE_WML}
        [/then]
        [else]
            {FEMALE_WML}
        [/else]
    [/if]
#enddef

#define TEACHER MESSAGE_TEXT
    [message]
        speaker=Galdrad
        message={MESSAGE_TEXT}
    [/message]
#enddef

# TODO: decide to use or not
#define NARRATOR CAPTION_TEXT MESSAGE_TEXT
    [message]
        speaker=narrator
        caption={CAPTION_TEXT}
        message={MESSAGE_TEXT}
        image=wesnoth-icon.png
    [/message]
#enddef

#define UNDO_REMINDER
    [message]
        speaker=narrator
        caption= _"Undo"
        image=wesnoth-icon.png
        message= _"Don’t forget, you can press <b>u</b> to undo most things; useful for correcting mistakes."
    [/message]

    [allow_undo][/allow_undo]
#enddef

#define TALK_ABOUT ID_STRING MESSAGE_TEXT
    [scroll_to_unit]
        id={ID_STRING}
    [/scroll_to_unit]

    [message]
        speaker=Galdrad
        scroll=no
        message={MESSAGE_TEXT}
    [/message]
#enddef

#define TALK_NO_MOVE MESSAGE_TEXT
    [message]
        speaker=Galdrad
        scroll=no
        message={MESSAGE_TEXT}
    [/message]
#enddef

#define TALK_ABOUT_LOC POSITION MESSAGE_TEXT
    [scroll_to]
        x,y={POSITION}
    [/scroll_to]

    [message]
        speaker=Galdrad
        scroll=no
        message={MESSAGE_TEXT}
    [/message]
#enddef

#define EXPLAIN_STRONG_INTELLIGENT ID_STRING
    [if]
        [variable]
            name=strongint_explained
            not_equals=done
        [/variable]
        [then]
            #po: This string used as follows: "<unit name>', your new recruit, has two traits...'"
            # Could be male or female unit? If so, might need gender-specific translations?
            {TEACHER ({ID_STRING} + _", your new recruit, has two traits: <i>strong</i> and <i>intelligent</i>. ‘Strong’ means a unit does more damage, and ‘intelligent’ means it needs less experience to advance a level.")}
            {VARIABLE strongint_explained done}
        [/then]
    [/if]
#enddef

#define EXPLAIN_QUICK_RESILIENT ID_STRING
    [if]
        [variable]
            name=quickres_explained
            not_equals=done
        [/variable]
        [then]
            #po: This string used as follows: "<unit name>' has two traits: <i>quick</i> and ...'"
            # Could be male or female unit? If so, might need gender-specific translations?
            {TEACHER ({ID_STRING} + _" has two traits: <i>quick</i> and <i>resilient</i>. ‘Quick’ means a unit can move one tile further each turn, and ‘resilient’ means it has more hitpoints.")}
            {VARIABLE quickres_explained done}
        [/then]
    [/if]
#enddef

#define CONTINUE_MSG
    _"
<big>Click a mouse button or press the spacebar to continue...</big>"
    # Note: we would not like the user to "press any key" (for example, Esc)
#enddef

#define CHECK_INTELLIGENT NAME
    [if]
        [variable]
            # Ignoring single-trait units, as we don't have those during the tutorial
            name={NAME}.modifications.trait.length
            equals=2
        [/variable]
        [then]
            [if]
                [variable]
                    name={NAME}.modifications.trait[0].id
                    equals=intelligent
                [/variable]
                [or]
                    [variable]
                        name={NAME}.modifications.trait[1].id
                        equals=intelligent
                    [/variable]
                [/or]
                [then]
                    {VARIABLE is_intelligent yes}
                [/then]
                [else]
                    {VARIABLE is_intelligent no}
                [/else]
            [/if]
        [/then]
        [else]
            {VARIABLE is_intelligent no}
        [/else]
    [/if]
#enddef

#define IMPORTANT_UNIT NAME
    {CHECK_INTELLIGENT {NAME}}
    [if]
        # Archer needs 44/35(intelligent), Fighter needs 40/32
        [variable]
            name={NAME}.type
            equals=Elvish Archer
        [/variable]
        {BOOLEQ is_intelligent no}
        [variable]
            name={NAME}.experience
            greater_than=35
        [/variable]
        [or]
            [variable]
                name={NAME}.type
                equals=Elvish Archer
            [/variable]
            {BOOLEQ is_intelligent yes}
            [variable]
                name={NAME}.experience
                greater_than=26
            [/variable]
        [/or]
        [or]
            [variable]
                name={NAME}.type
                equals=Elvish Fighter
            [/variable]
            {BOOLEQ is_intelligent no}
            [variable]
                name={NAME}.experience
                greater_than=31
            [/variable]
        [/or]
        [or]
            [variable]
                name={NAME}.type
                equals=Elvish Fighter
            [/variable]
            {BOOLEQ is_intelligent yes}
            [variable]
                name={NAME}.experience
                greater_than=23
            [/variable]
        [/or]
        [then]
            {VARIABLE commented 0}
            {FOREACH galdrad_comments i}
                [if]
                    [variable]
                        name=galdrad_comments[$i].id
                        equals=${NAME}.id
                    [/variable]
                    [then]
                        {VARIABLE commented 1}
                    [/then]
                [/if]
            {NEXT i}
            {CLEAR_VARIABLE i}

            [if]
                {NUMEQ commented 0}
                [then]
                    [store_unit]
                        [filter]
                            id=${NAME}.id
                        [/filter]
                        variable=galdrad_comments
                        mode=append
                    [/store_unit]
                    {TEACHER (_"That unit is about one kill (8 experience points) away from gaining a level! Do not let it die!")}
                [/then]
            [/if]
            {CLEAR_VARIABLE commented}
        [/then]
    [/if]
    {CLEAR_VARIABLE is_intelligent}
#enddef

#define DEFENDER_INJURED NAME
    [if]
        {NUMEQ {NAME}.side 1}
        [variable]
            name={NAME}.hitpoints
            less_than=19
        [/variable]
        [variable]
            name={NAME}.hitpoints
            greater_than=0
        [/variable]
        [then]
            {VARIABLE complained 0}

            # FIXME: If same unit gets attacked twice in same turn, this
            # does not seem to find it the second time. Some internal bug?

            {FOREACH unit_complained i}
                [if]
                    [variable]
                        name=unit_complained[$i].id
                        equals=${NAME}.id
                    [/variable]
                    [then]
                        {VARIABLE complained 1}
                    [/then]
                [/if]
            {NEXT i}

            [if]
                {NUMEQ complained 0}
                [then]
                    [store_unit]
                        [filter]
                            id=${NAME}.id
                        [/filter]
                        variable=unit_complained
                        mode=append
                    [/store_unit]
                    [if]
                        {NUMEQ complain_msg 2}
                        [then]
                            [message]
                                speaker=second_unit
                                message= _"I hope I have a chance to retreat after this!"
                            [/message]
                            {VARIABLE_OP complain_msg add 1}
                        [/then]
                    [/if]

                    [if]
                        {NUMEQ complain_msg 1}
                        [then]
                            [message]
                                speaker=second_unit
                                message= _"One lucky attack by an Orcish Grunt, and I’m done for!"
                            [/message]
                            {VARIABLE_OP complain_msg add 1}
                        [/then]
                    [/if]

                    [if]
                        {NUMEQ complain_msg 0}
                        [then]
                            [message]
                                speaker=second_unit
                                message= _"Ouch! I could make use of some healing in a village."
                            [/message]
                            {VARIABLE_OP complain_msg add 1}
                        [/then]
                    [/if]
                [/then]
            [/if]
            {CLEAR_VARIABLE i}
            {CLEAR_VARIABLE complained}
            {IMPORTANT_UNIT {NAME}}
        [/then]
    [/if]
#enddef

#define CHECK_INCOME
    [if]
        {NUMEQ income_exceeded 0}
        [then]
            [store_side]
            [/store_side]
            [if]
                [variable]
                    name=side.gold
                    greater_than=13
                [/variable]
                [then]
                    {VARIABLE income_exceeded 1}
                    # {STUDENT (_"I have $side.gold gold; enough to recruit!")}
                    {TALK_ABOUT_LOC 9,15 (_"Yes, keep recruiting more units: I think you might need them!")}
                [/then]
            [/if]
            {CLEAR_VARIABLE side}
        [/then]
    [/if]
#enddef
